<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>porodomo</title>
    <script>
        let timerId;
        let StartTime;
        let NowTime;
        let elapsedTime; //経過時間
        let time; // 残り時間s
        let min; // id="min"に渡す値
        let sec; // id="sec"に渡す値
        let lap = 1; // lap数
        let isWorking = 1; // 作業中フラグ
        const LAP_LIMIT = 3; // lap上限
        const SET_TIME = 15000; // 制限時間
        const REST_TIME = 10000;

        function start() {
            // 開始時間オブジェクト
            StartTime = new Date();
            // 現在時間オブジェクト
            clearInterval(timerId);
            elapsed();
            timerId = setInterval(elapsed, 1000);
        }

        function reset() {
            clearInterval(timerId);
            document.getElementById("min").textContent = 0;
            document.getElementById("sec").textContent = 0;
            document.getElementById("lap").textContent = 1;
            document.getElementById("rest").textContent = "";
        }

        function elapsed() {
            if (isWorking == 1) {
                // 作業中
                if (lap <= LAP_LIMIT) {
                    // lapが上限以下のとき
                    NowTime = new Date();
                    elapsedTime = NowTime.getTime() - StartTime.getTime();
                    time = SET_TIME - elapsedTime;
                    if (time > 0) {
                        // 経過時間が設定時間未満の時
                        min = Math.floor(time / 60000);
                        sec = Math.floor((time - min * 60000) / 1000);
                        document.getElementById("lap").textContent = lap;
                        document.getElementById("min").textContent = min;
                        document.getElementById("sec").textContent = sec;
                        document.getElementById("rest").textContent = "";
                    } else {
                        // 経過時間が設定時間以上のとき
                        lap += 1;
                        isWorking = 0;
                        StartTime = new Date();
                    }
                } else {
                    // lapが上限を超えたとき
                    clearInterval(timerId);
                    alert("終了しました");
                }
            } else {
                // 休憩中
                NowTime = new Date();
                elapsedTime = NowTime.getTime() - StartTime.getTime();
                time = REST_TIME - elapsedTime;
                if (time > 0) {
                    // 経過時間が休憩時間未満の時
                    min = Math.floor(time / 60000);
                    sec = Math.floor((time - min * 60000) / 1000);
                    document.getElementById("lap").textContent = lap;
                    document.getElementById("min").textContent = min;
                    document.getElementById("sec").textContent = sec;
                    document.getElementById("rest").textContent = "rest now.";
                } else {
                    // 経過時間が休憩時間以上のとき
                    isWorking = 1;
                    StartTime = new Date();
                }
            }
        }
    </script>
</head>

<body>
    <p>
        Lap<span id="lap"></span> : <span id="min">0</span> : <span id="sec">0</span><br><span id="rest">1</span>
    </p>
    <button onclick="start()">スタート</button>
    <button onclick="reset()">リセット</button>
</body>

</html>